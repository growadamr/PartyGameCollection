---
phase: 01-core-game-foundation
plan: 03
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - web-player/js/games/imposter.js
  - web-player/index.html
autonomous: true

must_haves:
  truths:
    - "Web player displays role (word or IMPOSTER) when game starts"
    - "Imposter players see 'IMPOSTER' prominently displayed"
    - "Non-imposter players see the secret word"
    - "All players see imposter count and discussion instructions"
  artifacts:
    - path: "web-player/js/games/imposter.js"
      provides: "Web player game handler"
      exports: "ImposterGame class, window.imposterGame"
      min_lines: 50
    - path: "web-player/index.html"
      provides: "Imposter game screen HTML"
      contains: "screen-imposter"
  key_links:
    - from: "web-player/js/games/imposter.js"
      to: "gameSocket.on('imposter_role')"
      via: "socket message handler"
      pattern: "gameSocket\\.on\\('imposter_role'"
    - from: "web-player/index.html"
      to: "web-player/js/games/imposter.js"
      via: "script tag"
      pattern: "js/games/imposter\\.js"
    - from: "web-player/js/app.js"
      to: "window.imposterGame"
      via: "startGame switch case"
---

<objective>
Create the web player client-side implementation for the Imposter game including JavaScript handler and HTML screen.

Purpose: Players need to see their assigned role (secret word or "IMPOSTER") on their phone screens during the discussion phase. The web player receives personalized role data from the host and displays appropriate UI.

Output: When host starts Imposter game, web players see their role displayed prominently with instructions for the discussion phase.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-core-game-foundation/01-RESEARCH.md

# Reference implementation to follow
@web-player/js/games/charades.js
@web-player/index.html
@web-player/js/app.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Imposter web player handler</name>
  <files>web-player/js/games/imposter.js</files>
  <action>
Create `web-player/js/games/imposter.js` following the charades.js pattern:

```javascript
/**
 * Imposter game handler for web player
 */
class ImposterGame {
    constructor() {
        this.app = null;
        this.isImposter = false;
        this.secretWord = "";
        this.imposterCount = 0;
        this.totalPlayers = 0;
    }

    init(app) {
        this.app = app;
        this.setupSocketHandlers();
    }

    setupSocketHandlers() {
        gameSocket.on('imposter_role', (data) => {
            this.handleRoleAssignment(data);
        });

        gameSocket.on('discussion_started', (data) => {
            // Discussion phase is free-form, just update UI if needed
            this.updateDiscussionUI();
        });
    }

    handleRoleAssignment(data) {
        this.isImposter = data.is_imposter;
        this.secretWord = data.word || "";
        this.imposterCount = data.imposter_count || 1;
        this.totalPlayers = data.total_players || 0;

        this.showRoleScreen();
    }

    showRoleScreen() {
        const roleLabel = document.getElementById('imposter-role-label');
        const wordDisplay = document.getElementById('imposter-word');
        const imposterInfo = document.getElementById('imposter-info');
        const instructionLabel = document.getElementById('imposter-instruction');

        // Update imposter count info
        if (imposterInfo) {
            const plural = this.imposterCount > 1 ? 'imposters' : 'imposter';
            imposterInfo.textContent = `There ${this.imposterCount > 1 ? 'are' : 'is'} ${this.imposterCount} ${plural} among you`;
        }

        if (this.isImposter) {
            // Player IS the imposter
            if (roleLabel) {
                roleLabel.textContent = "You are an IMPOSTER!";
                roleLabel.className = 'role-label imposter';
            }
            if (wordDisplay) {
                wordDisplay.textContent = "IMPOSTER";
                wordDisplay.className = 'word-display imposter';
            }
            if (instructionLabel) {
                instructionLabel.textContent = "Blend in! Figure out the secret word without revealing yourself.";
            }
        } else {
            // Player is NOT the imposter
            if (roleLabel) {
                roleLabel.textContent = "You are NOT the imposter!";
                roleLabel.className = 'role-label innocent';
            }
            if (wordDisplay) {
                wordDisplay.textContent = this.secretWord;
                wordDisplay.className = 'word-display innocent';
            }
            if (instructionLabel) {
                instructionLabel.textContent = "Discuss clues about the word to find the imposter!";
            }
        }
    }

    updateDiscussionUI() {
        // Could add additional UI updates when discussion starts
        // For now, role screen already shows discussion instructions
    }
}

// Global instance
window.imposterGame = new ImposterGame();
```

Key points:
- Class structure matches charades.js pattern
- Handles 'imposter_role' message with personalized data
- Updates DOM elements by ID (must match HTML)
- Global singleton pattern: `window.imposterGame`
  </action>
  <verify>
- File exists at `web-player/js/games/imposter.js`
- Contains ImposterGame class
- Contains `window.imposterGame = new ImposterGame()`
- Handles 'imposter_role' message type
  </verify>
  <done>
JavaScript handler exists with role display logic for both imposter and non-imposter players.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Imposter screen to index.html</name>
  <files>web-player/index.html</files>
  <action>
Edit `web-player/index.html` to add:

1. **Script tag** (before app.js, after other game scripts):
```html
<script src="js/games/imposter.js"></script>
```

2. **Game screen section** (after Quick Draw screen, before Game Over screen):
```html
<!-- Game: Imposter -->
<div id="screen-imposter" class="screen">
    <div class="game-header">
        <span class="game-title">Imposter</span>
    </div>

    <div class="game-content">
        <p class="role-label" id="imposter-role-label">Your Role</p>
        <div class="prompt-card large" id="imposter-word">???</div>
        <p class="info-text" id="imposter-info">? imposters among you</p>
        <p class="instruction" id="imposter-instruction">Waiting for game to start...</p>
    </div>
</div>
```

Element IDs must match JavaScript references:
- `imposter-role-label` - shows "You are an IMPOSTER!" or "You are NOT the imposter!"
- `imposter-word` - shows word or "IMPOSTER"
- `imposter-info` - shows imposter count
- `imposter-instruction` - shows phase instructions

Use existing CSS classes from style.css:
- `.game-header`, `.game-title` - header styling
- `.game-content` - main content area
- `.role-label` - role announcement text
- `.prompt-card.large` - large word display card
  </action>
  <verify>
- Script tag for imposter.js appears before app.js
- Screen div with id="screen-imposter" exists
- All referenced element IDs are present
  </verify>
  <done>
Imposter game screen added to index.html with all required elements and script reference.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add Imposter case to app.js startGame</name>
  <files>web-player/js/app.js</files>
  <action>
Edit `web-player/js/app.js` to add Imposter game case in the `startGame(gameId)` method:

Find the switch statement in startGame() and add:

```javascript
case 'imposter':
    this.showScreen('imposter');
    if (window.imposterGame) {
        imposterGame.init(this);
    }
    break;
```

Add this case after the existing games (charades, word_bomb, quick_draw) and before the default case.

The pattern matches existing games exactly:
1. Show the game screen
2. Check if handler exists
3. Initialize handler with app reference
  </action>
  <verify>
- `grep -A3 "case 'imposter'" web-player/js/app.js` shows the new case
- Case includes showScreen('imposter') and imposterGame.init(this)
  </verify>
  <done>
app.js routes 'imposter' game to correct screen and initializes handler.
  </done>
</task>

</tasks>

<verification>
- [ ] `web-player/js/games/imposter.js` exists with ImposterGame class
- [ ] `window.imposterGame` is defined globally
- [ ] Script tag appears in index.html before app.js
- [ ] Screen `#screen-imposter` exists in index.html
- [ ] All element IDs referenced in JS exist in HTML
- [ ] app.js contains 'imposter' case in startGame switch
</verification>

<success_criteria>
1. Web player shows correct screen when Imposter game starts
2. Imposter players see "IMPOSTER" label prominently
3. Non-imposter players see the secret word
4. All players see imposter count and instructions
5. Files created at correct paths (INT-03, INT-04)
6. Discussion phase requirements met (DISC-01, DISC-02 client side)
</success_criteria>

<output>
After completion, create `.planning/phases/01-core-game-foundation/01-03-SUMMARY.md`
</output>
