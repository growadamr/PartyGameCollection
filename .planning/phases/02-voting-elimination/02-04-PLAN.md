---
phase: 02-voting-elimination
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - web-player/js/games/imposter.js
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Players can tap any non-eliminated player to cast vote"
    - "Vote counts update in real-time as host broadcasts changes"
    - "Consensus warning displays with countdown and target name"
    - "Reveal shows dramatic pause then result with correct color"
    - "Eliminated players see spectator view with word revealed"
    - "Own vote shows highlighted border"
    - "Result view shows correct outcome text and styling"
  artifacts:
    - path: "web-player/js/games/imposter.js"
      provides: "Voting UI handlers with correct wiring"
      contains:
        - "imposter-role-view"
        - "imposter-voting-view"
        - "imposter-spectator-view"
        - "imposter-consensus-view"
        - "imposter-reveal-view"
        - "imposter-result-view"
        - "spectator-vote-list"
        - "consensus-target-name"
        - "result-role-text"
        - "spectator-word-display"
        - "my-vote"
        - "target_id"
        - "is_imposter"
        - "result-card"
  key_links:
    - from: "imposter.js showView()"
      to: "HTML view divs"
      via: "getElementById"
      pattern: "imposter-.*-view"
    - from: "imposter.js updateVoteCounts()"
      to: "HTML spectator-vote-list"
      via: "getElementById"
      pattern: "spectator-vote-list"
    - from: "imposter.js updateVoteHighlight()"
      to: "CSS .my-vote"
      via: "classList.add"
      pattern: "my-vote"
    - from: "imposter.js handleRevealResult()"
      to: "Host reveal_result message"
      via: "data field access"
      pattern: "target_id|is_imposter"
---

<objective>
Fix JavaScript ID/class mismatches preventing Phase 02 voting functionality from working.

Purpose: All 7 verification gaps stem from naming mismatches between JavaScript and HTML/CSS. The code logic is sound - only wiring is broken.
Output: Working voting system where all Phase 02 requirements function correctly.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-voting-elimination/02-VERIFICATION.md
@web-player/js/games/imposter.js
@web-player/index.html
@web-player/css/style.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix all JavaScript ID and class mismatches</name>
  <files>web-player/js/games/imposter.js</files>
  <action>
Fix 7 distinct naming mismatches in imposter.js:

**1. View IDs in showView() array (lines 98-105):**
Change from `-screen` suffix to `-view` suffix:
- `imposter-role-screen` -> `imposter-role-view`
- `imposter-vote-screen` -> `imposter-voting-view`
- `imposter-spectator-screen` -> `imposter-spectator-view`
- `imposter-consensus-screen` -> `imposter-consensus-view`
- `imposter-reveal-screen` -> `imposter-reveal-view`
- `imposter-result-screen` -> `imposter-result-view`

**2. Update showView() calls throughout the file:**
- Line 159: `showView('imposter-role-screen')` -> `showView('imposter-role-view')`
- Line 182: `showView('imposter-vote-screen')` -> `showView('imposter-voting-view')`
- Line 189: `showView('imposter-spectator-screen')` -> `showView('imposter-spectator-view')`
- Line 277: `showView('imposter-consensus-screen')` -> `showView('imposter-consensus-view')`
- Line 314: `showView('imposter-reveal-screen')` -> `showView('imposter-reveal-view')`
- Line 322: `showView('imposter-result-screen')` -> `showView('imposter-result-view')`

**3. Fix spectator container ID (lines 190, 251):**
- `spectator-player-list` -> `spectator-vote-list`

**4. Fix consensus target element ID (line 280):**
- `consensus-target` -> `consensus-target-name`

**5. Fix reveal result element IDs and logic (lines 318-342):**
- Change `data.eliminated_id` -> `data.target_id` (line 318)
- Change `data.was_imposter` -> `data.is_imposter` (line 319)
- Change `result-outcome` -> `result-role-text` (line 325)
- Change `imposter-result-screen` -> `imposter-result-view` (line 326)
- Change `resultScreen.className` assignments to set className on `result-card` element instead (lines 336, 340)

The result handling should look like:
```javascript
const resultCard = document.getElementById('result-card');
// ... in the if/else for imposter/innocent:
if (resultCard) {
    resultCard.className = wasImposter ? 'result-card imposter' : 'result-card innocent';
}
```

**6. Fix vote highlight class (lines 241-244):**
- Change `selected` -> `my-vote`

**7. Fix spectator word element ID (line 373):**
- `spectator-word` -> `spectator-word-display`

DO NOT change any logic - only fix the naming mismatches.
  </action>
  <verify>
Run grep to confirm all fixes:
```bash
# View IDs should be -view suffix
grep -c "imposter-.*-view" web-player/js/games/imposter.js

# Should NOT have -screen suffix anymore
grep -c "imposter-.*-screen" web-player/js/games/imposter.js

# Should have correct element IDs
grep "spectator-vote-list\|consensus-target-name\|result-role-text\|spectator-word-display" web-player/js/games/imposter.js

# Should use my-vote class
grep "my-vote" web-player/js/games/imposter.js

# Should read target_id and is_imposter from data
grep "data.target_id\|data.is_imposter" web-player/js/games/imposter.js

# Should set className on result-card
grep "result-card" web-player/js/games/imposter.js
```
  </verify>
  <done>
All 7 naming mismatches fixed:
- View IDs use `-view` suffix (6 IDs)
- Spectator container uses `spectator-vote-list`
- Consensus target uses `consensus-target-name`
- Reveal result reads `target_id` and `is_imposter` from host message
- Result text uses `result-role-text` element
- Result styling targets `result-card` element
- Vote highlight uses `my-vote` class
- Spectator word uses `spectator-word-display`
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Fixed all JavaScript ID/class mismatches to enable Phase 02 voting functionality</what-built>
  <how-to-verify>
1. Start the Godot game and web server
2. Join as a player from a browser
3. Start the Imposter game
4. **Verify role assignment works:** Role view should display correctly showing either "IMPOSTER" or the secret word
5. **Start voting phase:** Host should trigger voting
6. **Verify voting view displays:** Players should see the voting interface with all non-eliminated players listed
7. **Cast a vote:** Tap a player name - your vote should show a highlighted border (green outline)
8. **Verify vote counts update:** Other players' votes should cause counts to update in real-time
9. **Trigger consensus:** Have all players except one vote for the same person
10. **Verify consensus warning:** Countdown should appear with target name displayed
11. **Wait for reveal:** After countdown, reveal view should show, then result
12. **Verify result styling:** Result card should have imposter (red) or innocent (blue) gradient background
13. **If eliminated imposter:** Should see spectator view with word revealed
  </how-to-verify>
  <resume-signal>Type "approved" if voting functionality works, or describe any remaining issues</resume-signal>
</task>

</tasks>

<verification>
After completing Task 1, verify with grep commands that:
1. No `-screen` suffix IDs remain in showView array
2. All getElementById calls use correct HTML element IDs
3. CSS class `my-vote` is used instead of `selected`
4. Host message fields `target_id` and `is_imposter` are read correctly
5. Result card styling targets `#result-card` not the view container
</verification>

<success_criteria>
All 7 Phase 02 verification gaps are closed:
- [ ] Players can tap any non-eliminated player to cast vote
- [ ] Vote counts update in real-time as host broadcasts changes
- [ ] Consensus warning displays with countdown and correct target name
- [ ] Reveal shows dramatic pause then result with correct color
- [ ] Eliminated players see spectator view with word revealed
- [ ] Own vote shows highlighted border
- [ ] Result view shows correct outcome text and styling
</success_criteria>

<output>
After completion, create `.planning/phases/02-voting-elimination/02-04-SUMMARY.md`
</output>
